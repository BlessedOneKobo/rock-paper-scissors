<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Rock, Paper, Scissors</title>
</head>
<body>
	<script type="text/javascript">
		const weapons = ['rock', 'paper', 'scissors'];
		
		// Returns a string with its first character in uppercase
		function capitalize(str) {
			return str && (str[0].toUpperCase() + str.slice(1));
		}
		
		// Return a random number between 0 and {n}, excluding {n}
		function randomNumber(n) {
			return Math.floor(Math.random() * n);
		}

		// Return a random weapon choice
		function computerPlay() {
			return weapons[randomNumber(weapons.length)];
		}

		// Play a round of rock, paper, scissors
		function playRound(playerSelection, computerSelection) {
			let result = "lose";

			switch(playerSelection) {
				case "rock":
					switch(computerSelection) {
						case "rock":     result = "draw"; break;
						case "paper":    result = "lose"; break;
						case "scissors": result = "win";  break;
					}
					break;
				case "paper":
					switch(computerSelection) {
						case "rock":     result = "win"; break;
						case "paper":    result = "draw"; break;
						case "scissors": result = "lose";  break;
					}
					break;
				case "scissors":
					switch(computerSelection) {
						case "rock":     result = "lose"; break;
						case "paper":    result = "win"; break;
						case "scissors": result = "draw";  break;
					}
					break;
			}

			return result;
		}

		// Gets weapon choice from the user
		function getPlayerSelection() {
			let selection;
			while (true) {
				selection = prompt("Choose your weapon");
				if (selection && weapons.includes(selection.toLowerCase()))
					break;
			}
			return selection.toLowerCase();
		}

		// Update the player/computer score after each round
		function updateScore(roundStatus, playerScore, computerScore) {
			if (roundStatus == "win") {
				playerScore++;
			} else if (roundStatus == "lose") {
				computerScore++;
			}

			return [playerScore, computerScore];
		}

		// Display a message describing the result of the round
		function displayRoundMessage(result, playerSelection, computerSelection) {
			const summary = `You ${capitalize(result)}!`;
			
			let details = '';
			if (result == "win") {
				details = ` ${capitalize(playerSelection)} beats ${capitalize(computerSelection)}`;
			} else if (result == "lose") {
				details = ` ${capitalize(computerSelection)} beats ${capitalize(playerSelection)}`;
			}

			console.log(summary + details);
		}

		// Display the final message describing the summary of the game
		function displayFinalMessage(gameLength, playerScore, computerScore) {
			const draws = gameLength - (playerScore + computerScore);

			let message = `Player won ${playerScore}, Computer won ${computerScore}`;
			if (draws > 0) {
				const manyDraws = draws > 1;
				if (manyDraws) {
					message += `. There were ${draws} draws`;
				} else {
					message += `. There was one draw`;
				}
			}

			console.log(message);
		}

		// Game loop
		function game() {			
			let gameStatus;
			let playerSelection, computerSelection;
			let playerScore, computerScore;
			
			playerScore = 0;
			computerScore = 0;
			for (let i = 0; i < gameLength; i++) {
				playerSelection = getPlayerSelection();
				computerSelection = computerPlay();
				
				gameStatus = playRound(playerSelection, computerSelection);
				
				[playerScore, computerScore] = updateScore(gameStatus, playerScore, computerScore);
				displayRoundMessage(gameStatus, playerSelection, computerSelection);
			}

			displayFinalMessage(gameLength, playerScore, computerScore);
		}
		
		const gameLength = 5;
		game(gameLength);
	</script>
</body>
</html>